<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Diatotab, Diatonic Accordion / Melodeon Tablature Generator</title>
	<link rel="icon" href="favicon.ico">
	<link rel="stylesheet" href="styles.css">
	<link rel="stylesheet" href="abcjs-audio.css">
	<script src="abcjs-basic-min.js"></script>
	<!--<script src="../abcjs-melodeon-tab/dist/abcjs-basic.js"></script>-->
	<script src="diatotab.js"></script>
</head>
<body>
	<div class="container">
		<h1>Dia To Tab</h1>
		<div class="intro">
			<div>
				<p>
					Tablature generation tool for <a target="_blank" href=https://en.wikipedia.org/wiki/Diatonic_button_accordion>diatonic accordion / melodeon</a> and <a target="_blank" href=https://en.wikipedia.org/wiki/Harmonica>harmonica</a>. The tunes are entered in ABC notation, tablature is created based on instrument, layout and key selection.
				</p>
				<p>
					Many ABC tunes are available on <a target="_blank" href=https://folktunefinder.com>folktunefinder.com</a> and <a target="_blank" href="https://thesession.org">thesession.org</a>. More information about ABC notation can be found at <a target="_blank" href=https://abcnotation.com>abcnotation.com</a>.
				</p>
				<a href="#tool">Skip explanation and scroll to the tool</a>
			</div>
			<img style="margin-left:25px; width:300px; height:127px;" src="logo.png">
		</div>
		
		<h2>Additional functionality</h2>
		<p>
			Although the primary purpose of the tool is to generate tablature, there is other functionality that might come in handy.
		</p>
			<h4>Transposition</h4>
			<p>
				By the very nature of diatonic instruments, not all keys can be played. Therefore a transposition tool is built-in.
			</p>
			<p>
				If the key of the input ABC does not match you instrument, use the transpose control, for example to transpose from G/C to C/F set this value to 5 (half steps).
				Whenever a number is entered, the transposition is applied directly to the output. Click the 'Transpose ABC' button to apply the transposition to the input ABC.
			</p>
			
			<h4>ABC notation syntax highlighting</h4>
			<p>
				To make the ABC input easier to read, colors are added automatically to the input. Most importantly chords get different colors than treble notes and the treble note colors alternate.
			</p>

			<h4>Reading the dots</h4>
			<p>
				If you are trying to read the dots directly and no longer rely on tablature, it is possible to hide the tablature and display alternative note heads for notes played on the inner row(s) of the instrument. This resolves any ambiguity when reading the dots.
				Under the ABC example button, you can load the instrument layout, this will show the names of the dots and their mappings to instrument button numbers.
			</p>
			
			<h4>Playing by ear</h4>
			<p>
				For players that play by ear rather than tablature or dots, the tool allows you to playback the ABC tune. You can configure the amount of voices of the instrument and the amount of tremolo with which the instrument is tuned. You can choose to play only the melody or bass chords and control their relative volume if played simultaneously. Use the fade in/out control to make it should more staccato or legato.
			</p>
			
			<h4>Melodeon acquisition disorder (MAD) cure</h4>
			<p>
				Have you ever wondered how another keyboard layout would affect the difficulty of the tunes you are playing? Just select another layout and see instantly what it does to the tablature, no need to buy another melodeon.
			</p>
		
		<h2>Two and three row melodeons</h2>
			<p>
				There are some special layout options for melodeons with more than one row. For layouts with accidentals on the first button of each row, the push and pull notes of these buttons can be flipped. Same holds for 5', to configure the layout for 'Dutch reversal'. For melodeons with 4th button start, rather than the more common 3th button start, you can choose to start button numbering on 0 instead of 1, this is to make the tablature more similar to 3th button starts.
			</p>
			<p>
				For multi row layouts there are often multiple possibilities to play the same tune. The algorithm tries to find the easiest way, but you might not agree with the result. The push/pull direction is derived from the bass chord (written in ABC notation between " "). For chords that can be played in both directions you can add annotations to overrule the direction. In addition, annotations can be added to force the treble row number.<br>
			</p>
			<h4>Push/pull annotations</h3>
			<p>
				Example for G/C melodeon where the <b>G</b> chord can be played in both push and pull.<br>
				<b>&gt;</b> means push direction, write <b>"G&gt;"</b> to set G chord to push.<br>
				<b>&lt;</b> means pull direction, write <b>"G&lt;"</b> to set G chord to pull.<br>
			</p>
			<h4>Row number annotations</h4>
			<p>
				Example for G/C melodeon where the <b>a</b> note can be played on both the outer and the inner row (both in pull).<br>
				<b>.</b> means row 1 or outer row, write <b>"G."a</b> to play it with 11 (in pull).<br>
				<b>:</b> means row 2 or inner row, write <b>"G:"a</b> to play it with 9' (in pull).<br>
			</p>
			<p>
				For three rows, the row number annotations are extended. The example below is for a G/C/F.<br>
				<b>,</b> means row 3, write <b>"G,"a</b> to play it with 7" (in push).<br>
			</p>
		
		<h2 id="tool">Instrument / Tuning / Options</h2>
		<div class="blockborder">
			<select class="list" id="instrument" size="5" onchange="AddVariantsTunings()">
			</select>
		</div>
		<div id="variantdiv" class="blockborder">
			<select class="list" id="variant" size="5" onchange="ShowHideVariantOptions();CreateEditor();">
			</select>
		</div>
		<div id="tuningdiv" class="blockborder">
			<select class="list" id="tuning" size="5" onchange="CreateEditor()">
			</select>
		</div>
		<div id="invdiv" class="block">
			<div id="startzero">
				<input type="checkbox" id="zero"  onchange="ShowHideVariantOptions();CreateEditor();">
				<label for="zero">Start numbering at 0</label>
			</div>
			<div id="inv1div">
				<input type="checkbox" id="inv1"  onchange="ShowHideVariantOptions();CreateEditor()">
				<label for="inv1" id="inv1_lab">Button 1 push/pull reverse</label>
			</div>
			<div id="inv2div">
				<input type="checkbox" id="inv2"  onchange="ShowHideVariantOptions();CreateEditor()">
				<label for="inv2" id="inv2_lab">Button 2 push/pull reverse</label>
			</div>
			<div id="inv1adiv">
				<input type="checkbox" id="inv1a" onchange="CreateEditor()">
				<label for="inv1a" id="inv1a_lab">Button 1' push/pull reverse</label>
			</div>
			<div id="inv1bdiv">
				<input type="checkbox" id="inv1b" onchange="CreateEditor()">
				<label for="inv1b" id="inv1b_lab">Button 1" push/pull reverse</label>
			</div>
			<div id="inv5adiv">
				<input type="checkbox" id="inv5a" onchange="ShowHideVariantOptions();CreateEditor()">
				<label for="inv5a" id="inv5a_lab">Button 5' push/pull reverse</label>
			</div>
			<div id="inv6adiv">
				<input type="checkbox" id="inv6a" onchange="ShowHideVariantOptions();CreateEditor()">
				<label for="inv6a" id="inv6a_lab">Button 6' push/pull reverse</label>
			</div>
		</div>
		<div id="optdiv" class="block">
			<label for="tabmode" id="tabmode_lab">&nbsp;Tablature algorithm</label>
			<select name="tabmode" id="tabmode" onchange="CreateEditor()">
				<option value="0">Normal</option>
				<option value="1">Show all remaining possibilities</option>
				<option value="2">Show all possibilities</option>
			</select><br>
			<input type="checkbox" id="innerstyle"  onchange="CreateEditor()">
			<label for="innerstyle" id="innerstyle_lab">Use * instead of ' for inner row</label><br>
			<input type="checkbox" id="changenotehead"  onchange="CreateEditor()" checked>
			<label for="changenotehead" id="changenotehead_lab">Use diamand note heads for inner row notes</label>
		</div>
		<div class="blockend"></div>
	</div>
		
	<div class="float-container">
		<div id="abctop" class="float-child-abc">
			<div id="abcheader" style="box-sizing:border-box;">
				<h2>ABC Editor</h2>
				<div class="block">
					<button onclick="ExampleShow()">Load ABC Example</button><br>
				</div>
				<div class="blockright">
					<label for="transpose">Transpose</label>
					<input type="number" id="transpose" value="0" min="-24" max="24" size="4" onchange="CreateEditor()">
					<button  onclick="TransposeAbc()">Transpose ABC</button>
					<button onclick="Print()">Print</button>
				</div>
				<div class="blockend"></div>
			</div>
			<div id="abcscroll" class="abcscroll">
				<div class="highLite">
					<div class="highLite_colors"   id="abc_colors"></div>
					<div class="highLite_editable" id="abc_editable" contenteditable="true" spellcheck="false" onkeydown="AbcKeyDown()" onpaste="AbcPaste(event)" oninput="AbcInput()" onmousemove="AbcSelect()">
T: Andro<br>
C: Trad. (Bretagne)<br>
R: Andro<br>
Q: 1/4=160<br>
M: 4/4<br>
L: 1/4<br>
K: C<br>
|:"Am"e e/2f/2 e3/2 d/2|c B AA|"G>"ddBG |"F&lt;"A/2B/2 c/2d/2 "Em"e2|<br>
"Am"e e/2f/2 e3/2 d/2  |cB AA |"G>"ddBG |"F&lt;"A/2B/2 c/2B/2 "Am"A2:|<br>
|:"C"eg"Am"A2|"C"eg"G>"B2|ddB/2A/2G|"F&lt;"A/2B/2 c/2d/2 "Em>"e2|<br>
"C"eg"Am"A2|"C"eg"G>"B2|ddB/2A/2G|"F&lt;"A/2B/2 c/2B/2 "Am"A2:|<br>
<br>
T: Kerfank 1870/Den Andro<br>
S: Gonnagles Balfolksessieboekje 1<br>
C: Trad. (Bretagne)<br>
R: Andro<br>
Q: 1/4=160<br>
M: 4/4<br>
L: 1/4<br>
K: C<br>
|:"Am"Aeed/e/|"F&lt;"fed/c/ B/c/|"G&gt;"dB"C"ed/c/|B/c/ A/B/"Em"cB|<br>
|"Am"Aeed/e/|"F&lt;"fed/c/ B/c/|"G&gt;"dB"C"ed/c/|"Em"B/A/ B/c/"Am"A2:|<br>
|:"Am"AA"G&lt;"Bc/B/|"F&lt;"AA"Em"BB/c/|"G&gt;"dB"C"ed/c/|"F"B/c/ A/B/"Em"cB|<br>
|"Am"AA"G&lt;"Bc/B/|"F&lt;"AA"Em"BB/c/|"G&gt;"dB"C"ed/c/|"Em"B/A/ B/c/"Am"A2:|<br>
<br>
T: Mon Père Avait un Gars Lonla<br>
S: Gonnagles Balfolksessieboekje 1<br>
C: Trad.<br>
R: Hanter dro<br>
Q: 1/4=160<br>
M: 6/4<br>
L: 1/4<br>
K: C<br>
|:"Am"AB/c/BA"Dm"G/F/E|"F"AB/c/Ad"G"cB|"Am"AB/c/BA"Dm"G/F/E|"F"AB/c/"G"AG"Am"A2:|<br>
|:"Am"AB/c/dBc/d/e|"G"cB/A/dcB2|"F"AB/c/dBc/d/e|"G"cB/A/"Em"Bc"Am"A2:|<br>
<br>
T: What Shall We Do With the Drunken Sailor?<br>
C: Trad. (England)<br>
M: 4/4<br>
L: 1/8<br>
Q: 1/4=160<br>
K: C<br>
"Am"E2EE E2EE|"Am"E2A,2C2E2|"G"D2DD D2DD|"G"D2G,2B,2D2|<br>
w: What shall we do with the drunk-en sail-or, what shall we do with the drunk-en sail-or<br>
"Am"E2EE E2EE|"Am"E2F2G2A2|"Em"G2E2 "G"D2B,2|"Am"A,4A,2 z2|<br>
w: What shall we do with the drunk-en sail-or, earl-y in the morn-ing?<br>
"Am"E4 E3E|"Am"E2A,2C2E2|"G"D4 D3D|"G"D2G,2B,2D2|<br>
w: Way-hay, and up she ris-es, way-hay, and up she ris-es<br>
"Am"E4 E3E|"Am"E2F2G2A2|"Em"G2E2 "G"D2B,2|"Am"A,4A,2 z2|<br>
w: Way-hay, and up she ris-es, earl-y in the morn-ing.<br>
<br>
					</div>
				</div>
				<textarea id="abc" style="display:none;height:100%" spellcheck="false">
				</textarea>
			</div>
			<div id="abcfooter" class="blockend">
				<div id="warnings"></div>
				<h2>Playback</h2>
				<div class="block">
					
					<table>
						<tr><td>Voices </td><td><select id="reeds" style="width:100%;" onchange="CreateEditor()"></select>                                      </td></tr>
						<tr><td>Tremolo</td><td><input type="range" min="0" max="30"  value="5" class="slider"  id="cents" onchange="CreateEditor(false, true)"></td></tr>
					</table>
				</div>
				<div class="block">
					<table>
						<tr><td>Bass volume</td><td><input type="range" min="0" max="150" value="100" class="slider" id="bassvol" onchange="CreateEditor()">           </td></tr>
						<tr><td>Fade in/out</td><td><input type="range" min="1" max="250" value="50"  class="slider" id="fade"    onchange="CreateEditor(false, true)"></td></tr>
					</table>
				</div>
				<div class="blockright">
					<button onclick="DownloadWav()">Download</button>
				</div>
				<div class="blockend"></div>
				<input type="hidden" id="repeat" value="false">
				<div id="audio"></div>
			</div>
		</div>
		<div id="tabtop" class="float-child-tab">
			<h2  id="tabheader">Tablature</h2>
			<div id="paper" class="paper"></div>
		</div>
		<div class="blockend"></div>
	</div>
	<div id="footer" class="footer">
		The application runs client side using a fork of <a target="_blank" href='https://www.abcjs.net'>abcjs</a>, no data is send to the server.<br>Created by Rick van der Sluijs, <a href="#" id="link" onmouseover="setLink()" onmousedown="setLink()" onclick="setLink()" onfocusout="clearLink()">mail</a> me for questions or bug reports. Github repository of abcjs fork <a target="_blank" href='https://github.com/RickvanderS/abcjs-melodeon-tab'>here</a>, website <a target="_blank" href='https://github.com/RickvanderS/diatotab.com'>here</a>.
	</div>
	
	<div class="overlay-container" id="example" onclick="ExampleClose()">
		<div class="overlay" onclick="event.stopPropagation()">
			<h4>Instrument Layout</h4>
			<a href="" onclick="return ExampleLoad(0)">Diatonic scale order</a><br>
			<a href="" onclick="return ExampleLoad(1)">Button order</a><br>
			<h4>Example Tunes</h4>
			<a href="" onclick="return ExampleLoad(2)">Andro</a><br>
			<a href="" onclick="return ExampleLoad(3)">Kerfank 1870/Den Andro</a><br>
			<a href="" onclick="return ExampleLoad(4)">Mon Père Avait un Gars Lonla</a><br>
			<a href="" onclick="return ExampleLoad(5)">What Shall We Do With the Drunken Sailor?</a><br>
			<br>
			<b><a href="" onclick="return ExampleClose()">Close</a></b><br>
			<br>
		</div>
	</div>
	<div id="print_paper" class="print_paper"></div>
	
	<script>
		window.onload = function() {
			InitPage();
		}
	</script>
</body>
</html>